# IPP-CUPS - IPVLAN-L2
services:
  cups:
    image: olbat/cupsd:latest
    container_name: Cups-server
    restart: unless-stopped
    
    # Privilegios necesarios para acceder a dispositivos USB
    privileged: true
    
    ports:
      # Puerto para la interfaz web de administración
      - "631:631"
      # Puerto IPP alternativo si necesitas exponerlo
      # - "631:631/udp"
    
    volumes:
      # Persistencia de configuración de CUPS
      - cups_config:/etc/cups
      # Persistencia de trabajos de impresión
      - cups_spool:/var/spool/cups
      # Logs de CUPS
      - cups_logs:/var/log/cups
      # Acceso a dispositivos USB (impresoras conectadas)
      - /dev/bus/usb:/dev/bus/usb
    
    environment:
      # Usuario administrador de CUPS
      - CUPS_USER_ADMIN=admin
      # Contraseña del administrador (CAMBIAR en producción)
      - CUPS_USER_PASSWORD=123456789mix
      # Permitir administración remota
      - CUPS_WEBINTERFACE=yes
    
    networks:
      Antares:
        ipv4_address: 192.168.18.115

  # Servicio opcional: Servidor de archivos Samba para compartir impresoras en Windows
  samba:
    image: dperson/samba
    container_name: cups-samba
    restart: unless-stopped
    
    ports:
      - "139:139"
      - "445:445"
    
    environment:
      # Usuario para acceso a impresoras compartidas
      - USER=print;printpass
      # Compartir impresoras de CUPS
      - SHARE=Impresoras;/var/spool/samba;yes;no;no;all;print
    
    volumes:
      - samba_spool:/var/spool/samba
    
    networks:
      Antares:
        ipv4_address: 192.168.18.116
    
    depends_on:
      - cups

volumes:
  cups_config:
    driver: local
  cups_spool:
    driver: local
  cups_logs:
    driver: local
  samba_spool:
    driver: local

networks:
  Antares:
    driver: ipvlan
    external: true